<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riassunto Audio con Pratica AI: Articoli Italiani</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .glassmorphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      /* Stile per il loader */
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4"
  >
    <div class="w-full max-w-2xl mx-auto space-y-8">
      <!-- Sezione Player Audio -->
      <div class="glassmorphism rounded-2xl shadow-lg p-6 md:p-8">
        <h1
          class="text-2xl md:text-3xl font-bold text-center mb-4 text-cyan-300"
        >
          Riassunto Audio: Articoli Italiani
        </h1>
        <p class="text-center text-gray-300 mb-6">
          Livello A1 - Premi play per ascoltare la lezione.
        </p>

        <!-- Controlli Audio -->
        <div
          id="controls"
          class="flex items-center justify-center space-x-4 mb-6"
        >
          <button
            id="playBtn"
            class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg flex items-center space-x-2"
          >
            <i class="fas fa-play"></i>
            <span>Play</span>
          </button>
          <button
            id="pauseBtn"
            class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg flex items-center space-x-2"
            disabled
          >
            <i class="fas fa-pause"></i>
            <span>Pause</span>
          </button>
          <button
            id="stopBtn"
            class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg flex items-center space-x-2"
            disabled
          >
            <i class="fas fa-stop"></i>
            <span>Stop</span>
          </button>
        </div>

        <div id="status" class="text-center text-gray-400 my-4 h-6"></div>

        <!-- Trascrizione -->
        <div
          class="bg-gray-800/50 p-4 rounded-lg max-h-60 overflow-y-auto border border-gray-700"
        >
          <h2 class="text-xl font-semibold mb-3 text-cyan-400">Trascrizione</h2>
          <div id="transcript" class="text-gray-200 leading-relaxed space-y-3">
            <!-- Il contenuto della trascrizione rimane qui -->
            <p>
              Ciao e benvenuti a questa prima lezione di italiano! Oggi parliamo
              di un argomento fondamentale: gli articoli.
            </p>
            <p>
              Gli articoli in italiano possono essere di due tipi:
              <strong>determinativi</strong>, quando ci riferiamo a qualcosa di
              specifico, e <strong>indeterminativi</strong>, quando parliamo di
              qualcosa in modo generico.
            </p>
            <p>Iniziamo con gli <strong>articoli determinativi</strong>...</p>
            <p>
              Per il <strong>maschile singolare</strong>, l'articolo più comune
              è <strong>il</strong>. Per esempio: <em>il libro</em>.
            </p>
            <p>
              Il plurale di <em>il</em> è <strong>i</strong>. Quindi diremo:
              <em>i libri</em>.
            </p>
            <p>
              Usiamo l'articolo <strong>lo</strong> (al singolare) prima di
              parole maschili che iniziano con: s + consonante, zeta, etc. Per
              esempio: <em>lo studente</em>, <em>lo zio</em>.
            </p>
            <p>
              Il plurale di <em>lo</em> è <strong>gli</strong>. Quindi avremo:
              <em>gli studenti</em>, <em>gli zii</em>.
            </p>
            <p>
              Se una parola maschile inizia per <strong>vocale</strong>, usiamo
              <strong>l'</strong>. Al plurale, diventa <strong>gli</strong>.
              Esempio: <em>l'amico</em>, <em>gli amici</em>.
            </p>
            <p>
              Passiamo al <strong>femminile</strong>. Usiamo quasi sempre
              <strong>la</strong>. Se inizia per vocale, usiamo
              <strong>l'</strong>. Esempio: <em>la casa</em>, <em>l'amica</em>.
            </p>
            <p>
              Al plurale, tutte le parole femminili usano l'articolo
              <strong>le</strong>. Esempio: <em>le case</em>,
              <em>le amiche</em>.
            </p>
            <p>
              Ora gli <strong>articoli indeterminativi</strong> (solo
              singolare). Per il <strong>maschile</strong>, usiamo
              <strong>un</strong>. Per le parole che iniziano con s +
              consonante, z, etc., usiamo <strong>uno</strong>. Esempio:
              <em>un treno</em>, <em>uno zaino</em>.
            </p>
            <p>
              Per il <strong>femminile</strong>, usiamo <strong>una</strong>. Se
              inizia per vocale, diventa <strong>un'</strong>. Esempio:
              <em>una casa</em>, <em>un'isola</em>.
            </p>
            <p>
              Ricapitolando: fate sempre attenzione al genere, al numero e alla
              prima lettera della parola.
            </p>
            <p>Spero sia tutto chiaro. Alla prossima!</p>
          </div>
        </div>
      </div>

      <!-- Sezione Pratica con AI (Gemini API) -->
      <div class="glassmorphism rounded-2xl shadow-lg p-6 md:p-8">
        <h2
          class="text-2xl md:text-3xl font-bold text-center mb-4 text-teal-300"
        >
          Pratique com a IA ✨
        </h2>
        <p class="text-center text-gray-300 mb-6">
          Digite um substantivo em italiano para ver exemplos e a regra.
        </p>

        <div class="flex flex-col sm:flex-row items-center gap-4">
          <input
            type="text"
            id="nounInput"
            class="w-full flex-grow bg-gray-700 text-white border-2 border-gray-600 rounded-lg py-2 px-4 focus:outline-none focus:border-teal-500 transition"
            placeholder="Es. libro, studentessa, zaino..."
          />
          <button
            id="generateBtn"
            class="w-full sm:w-auto bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2"
          >
            <i class="fas fa-magic"></i>
            <span>Gerar Exemplos</span>
          </button>
        </div>

        <!-- Area Risultati -->
        <div id="loader" class="loader hidden"></div>
        <div
          id="aiResult"
          class="mt-6 bg-gray-800/50 p-4 rounded-lg border border-gray-700 min-h-[100px]"
        >
          <p class="text-gray-400">Os resultados aparecerão aqui...</p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- Logica del Player Audio ---
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const transcriptDiv = document.getElementById('transcript');
        const statusDiv = document.getElementById('status');

        if (!('speechSynthesis' in window)) {
          statusDiv.textContent =
            'Spiacenti, il tuo browser non supporta la sintesi vocale.';
          playBtn.disabled = true;
          return;
        }

        let utterance = new SpeechSynthesisUtterance();
        let italianVoice = null;

        function getCleanText() {
          const paragraphs = transcriptDiv.querySelectorAll('p');
          let text = '';
          paragraphs.forEach((p) => {
            text += p.textContent + ' ';
          });
          return text.trim();
        }

        utterance.text = getCleanText();
        utterance.lang = 'it-IT';
        utterance.rate = 0.95;
        utterance.pitch = 1;

        function loadVoices() {
          const voices = speechSynthesis.getVoices();
          italianVoice = voices.find((voice) => voice.lang === 'it-IT');
          if (italianVoice) utterance.voice = italianVoice;
        }

        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        function updateControls(isPlaying, isPaused) {
          playBtn.disabled = isPlaying && !isPaused;
          pauseBtn.disabled = !isPlaying || isPaused;
          stopBtn.disabled = !isPlaying && !isPaused;
        }

        playBtn.addEventListener('click', () => {
          if (speechSynthesis.paused) {
            speechSynthesis.resume();
          } else {
            speechSynthesis.speak(utterance);
          }
        });

        pauseBtn.addEventListener('click', () => speechSynthesis.pause());
        stopBtn.addEventListener('click', () => speechSynthesis.cancel());

        utterance.onstart = () => {
          statusDiv.textContent = 'In riproduzione...';
          updateControls(true, false);
        };
        utterance.onpause = () => {
          statusDiv.textContent = 'In pausa.';
          updateControls(true, true);
        };
        utterance.onresume = () => {
          statusDiv.textContent = 'In riproduzione...';
          updateControls(true, false);
        };
        utterance.onend = () => {
          statusDiv.textContent = 'Lezione completata.';
          updateControls(false, false);
          playBtn.disabled = false;
          pauseBtn.disabled = true;
          stopBtn.disabled = true;
        };
        utterance.onerror = (event) => {
          statusDiv.textContent = 'Errore durante la riproduzione.';
          updateControls(false, false);
        };

        updateControls(false, false);

        // --- Logica Gemini API ---
        const generateBtn = document.getElementById('generateBtn');
        const nounInput = document.getElementById('nounInput');
        const aiResultDiv = document.getElementById('aiResult');
        const loader = document.getElementById('loader');

        generateBtn.addEventListener('click', async () => {
          const noun = nounInput.value.trim();
          if (!noun) {
            aiResultDiv.innerHTML =
              '<p class="text-yellow-400">Por favor, insira um substantivo italiano.</p>';
            return;
          }

          aiResultDiv.innerHTML = '';
          loader.classList.remove('hidden');
          generateBtn.disabled = true;

          const prompt = `Based on the Italian noun "${noun}", provide a JSON object with the following properties: gender ("maschile" or "femminile"), singular_definite, plural_definite, singular_indefinite, example_def_sing, example_def_plur, example_indef_sing, and a brief explanation in Portuguese of the rule for choosing the articles.`;

          const payload = {
            contents: [{ role: 'user', parts: [{ text: prompt }] }],
            generationConfig: {
              responseMimeType: 'application/json',
              responseSchema: {
                type: 'OBJECT',
                properties: {
                  gender: { type: 'STRING' },
                  singular_definite: { type: 'STRING' },
                  plural_definite: { type: 'STRING' },
                  singular_indefinite: { type: 'STRING' },
                  example_def_sing: { type: 'STRING' },
                  example_def_plur: { type: 'STRING' },
                  example_indef_sing: { type: 'STRING' },
                  explanation: { type: 'STRING' },
                },
              },
            },
          };

          const apiKey = '';
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

          try {
            const response = await fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
            });

            if (!response.ok) {
              throw new Error(
                `API Error: ${response.statusText} (Status: ${response.status})`
              );
            }

            const result = await response.json();

            if (result.candidates && result.candidates.length > 0) {
              const jsonText = result.candidates[0].content.parts[0].text;
              const data = JSON.parse(jsonText);

              const resultHTML = `
                            <h3 class="text-xl font-bold text-teal-300 mb-3">Análise para: <span class="text-white">${noun}</span></h3>
                            <div class="space-y-3 text-gray-200">
                                <p><strong>Gênero:</strong> ${data.gender}</p>
                                <p><strong>Artigo Definido:</strong> ${data.singular_definite} (singular), ${data.plural_definite} (plural)</p>
                                <p><strong>Artigo Indefinido:</strong> ${data.singular_indefinite} (singular)</p>
                                <div class="pt-2 border-t border-gray-600 mt-3">
                                    <h4 class="font-semibold text-teal-400">Exemplos:</h4>
                                    <ul class="list-disc list-inside ml-4">
                                        <li>${data.example_def_sing}</li>
                                        <li>${data.example_def_plur}</li>
                                        <li>${data.example_indef_sing}</li>
                                    </ul>
                                </div>
                                <div class="pt-2 border-t border-gray-600 mt-3">
                                     <h4 class="font-semibold text-teal-400">Explicação da Regra:</h4>
                                     <p>${data.explanation}</p>
                                </div>
                            </div>
                        `;
              aiResultDiv.innerHTML = resultHTML;
            } else {
              throw new Error(
                'A resposta da API não contém resultados válidos.'
              );
            }
          } catch (error) {
            console.error('Erro ao chamar a API Gemini:', error);
            aiResultDiv.innerHTML = `<p class="text-red-400">Desculpe, ocorreu um erro. Tente novamente. (${error.message})</p>`;
          } finally {
            loader.classList.add('hidden');
            generateBtn.disabled = false;
          }
        });
      });
    </script>
  </body>
</html>
